//! Opset 12 compliance tests.
//!
//! Auto-generated by gen_rust_tests.py. Edit the generator, not this file.

use super::helpers::*;

#[test]
fn arg_max() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "argmax");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ArgMax(
        ArgMaxNode {
            name: "argmax1",
            inputs: [
                Argument {
                    name: "argmax_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "argmax1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 3,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ArgMaxConfig {
                axis: 1,
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn arg_min() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "argmin");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ArgMin(
        ArgMinNode {
            name: "argmin1",
            inputs: [
                Argument {
                    name: "argmin_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "argmin1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 3,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ArgMinConfig {
                axis: 1,
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn celu() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "celu");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Celu(
        CeluNode {
            name: "celu1",
            inputs: [
                Argument {
                    name: "celu_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "celu1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: CeluConfig {
                alpha: 1.0,
            },
        },
    )
    "#);
}

#[test]
fn clip() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "clip");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Clip(
        ClipNode {
            name: "clip1",
            inputs: [
                Argument {
                    name: "clip_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Scalar(
                        F32,
                    ),
                    value_source: Static(
                        0,
                    ),
                },
                Argument {
                    name: "",
                    ty: Scalar(
                        F32,
                    ),
                    value_source: Static(
                        1,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "clip1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ClipConfig {
                min: Some(
                    Static(
                        0.0,
                    ),
                ),
                max: Some(
                    Static(
                        6.0,
                    ),
                ),
            },
        },
    )
    "#);
}

#[test]
fn constant() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "constant");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Constant(
        ConstantNode {
            name: "constant5",
            inputs: [
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        4,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "constant5_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
            ],
        },
    )
    "#);
}

/// Dropout is eliminated during post-processing (no-op).
/// Verify the model parses without error.
#[test]
fn dropout() {
    let _graph = load_model("opset_12.onnx");
}

#[test]
fn gather_nd() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "gathernd");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    GatherND(
        GatherNDNode {
            name: "gathernd1",
            inputs: [
                Argument {
                    name: "gathernd_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "constant5_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
            ],
            outputs: [
                Argument {
                    name: "gathernd1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: GatherNDConfig {
                batch_dims: 0,
            },
        },
    )
    "#);
}

#[test]
fn greater_or_equal() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "greaterorequal");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    GreaterOrEqual(
        GreaterOrEqualNode {
            name: "greaterorequal1",
            inputs: [
                Argument {
                    name: "greaterorequal_a",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "greaterorequal_b",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "greaterorequal1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: Bool,
                            rank: 3,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
        },
    )
    "#);
}

#[test]
fn less_or_equal() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "lessorequal");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    LessOrEqual(
        LessOrEqualNode {
            name: "lessorequal1",
            inputs: [
                Argument {
                    name: "lessorequal_a",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "lessorequal_b",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "lessorequal1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: Bool,
                            rank: 3,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
        },
    )
    "#);
}

#[test]
fn max() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "max");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Max(
        MaxNode {
            name: "max1",
            inputs: [
                Argument {
                    name: "max_a",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "max_b",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "max1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
        },
    )
    "#);
}

#[test]
fn max_pool() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "maxpool2d");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    MaxPool2d(
        MaxPool2dNode {
            name: "maxpool2d1",
            inputs: [
                Argument {
                    name: "maxpool_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        8,
                                    ),
                                    Some(
                                        8,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "maxpool2d1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        8,
                                    ),
                                    Some(
                                        8,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: MaxPool2dConfig {
                kernel_size: [
                    2,
                    2,
                ],
                strides: [
                    2,
                    2,
                ],
                padding: Valid,
                dilation: [
                    1,
                    1,
                ],
                ceil_mode: false,
                auto_pad: NotSet,
            },
        },
    )
    "#);
}

#[test]
fn min() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "min");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Min(
        MinNode {
            name: "min1",
            inputs: [
                Argument {
                    name: "min_a",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "min_b",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "min1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
        },
    )
    "#);
}

#[test]
fn pow() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "pow");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Pow(
        PowNode {
            name: "pow1",
            inputs: [
                Argument {
                    name: "pow_a",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "pow_b",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "pow1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
        },
    )
    "#);
}

#[test]
fn reduce_max() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "reducemax");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceMax(
        ReduceMaxNode {
            name: "reducemax1",
            inputs: [
                Argument {
                    name: "reducemax_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducemax1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_min() {
    let graph = load_model("opset_12.onnx");
    let node = find_node(&graph, "reducemin");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceMin(
        ReduceMinNode {
            name: "reducemin1",
            inputs: [
                Argument {
                    name: "reducemin_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducemin1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}
