//! Opset 11 compliance tests.
//!
//! Auto-generated by gen_rust_tests.py. Edit the generator, not this file.

use super::helpers::*;

#[test]
fn arg_max() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "argmax");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ArgMax(
        ArgMaxNode {
            name: "argmax1",
            inputs: [
                Argument {
                    name: "argmax_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "argmax1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 3,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ArgMaxConfig {
                axis: 1,
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn arg_min() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "argmin");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ArgMin(
        ArgMinNode {
            name: "argmin1",
            inputs: [
                Argument {
                    name: "argmin_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "argmin1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 3,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ArgMinConfig {
                axis: 1,
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn average_pool() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "averagepool2d");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    AveragePool2d(
        AveragePool2dNode {
            name: "averagepool2d1",
            inputs: [
                Argument {
                    name: "averagepool_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        8,
                                    ),
                                    Some(
                                        8,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "averagepool2d1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: AvgPool2dConfig {
                kernel_size: [
                    2,
                    2,
                ],
                strides: [
                    2,
                    2,
                ],
                padding: Valid,
                count_include_pad: false,
                dilation: [
                    1,
                    1,
                ],
                ceil_mode: false,
                auto_pad: NotSet,
            },
        },
    )
    "#);
}

#[test]
fn bit_shift() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "bitshift");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    BitShift(
        BitShiftNode {
            name: "bitshift1",
            inputs: [
                Argument {
                    name: "bitshift_a",
                    ty: Tensor(
                        TensorType {
                            dtype: U32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "bitshift_b",
                    ty: Tensor(
                        TensorType {
                            dtype: U32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "bitshift1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: U32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: BitShiftConfig {
                direction: Left,
            },
        },
    )
    "#);
}

#[test]
fn clip() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "clip");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Clip(
        ClipNode {
            name: "clip1",
            inputs: [
                Argument {
                    name: "clip_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Scalar(
                        F32,
                    ),
                    value_source: Static(
                        0,
                    ),
                },
                Argument {
                    name: "",
                    ty: Scalar(
                        F32,
                    ),
                    value_source: Static(
                        1,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "clip1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ClipConfig {
                min: Some(
                    Static(
                        0.0,
                    ),
                ),
                max: Some(
                    Static(
                        6.0,
                    ),
                ),
            },
        },
    )
    "#);
}

#[test]
fn concat() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "concat");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Concat(
        ConcatNode {
            name: "concat1",
            inputs: [
                Argument {
                    name: "concat_a",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "concat_b",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "concat1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ConcatConfig {
                axis: 0,
            },
        },
    )
    "#);
}

#[test]
fn constant() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "constant");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Constant(
        ConstantNode {
            name: "constant6",
            inputs: [
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        5,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "constant6_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
            ],
        },
    )
    "#);
}

#[test]
fn conv() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "conv2d");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Conv2d(
        Conv2dNode {
            name: "conv2d1",
            inputs: [
                Argument {
                    name: "conv_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        5,
                                    ),
                                    Some(
                                        5,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        2,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "conv2d1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: Conv2dConfig {
                kernel_size: [
                    3,
                    3,
                ],
                stride: [
                    1,
                    1,
                ],
                padding: Valid,
                dilation: [
                    1,
                    1,
                ],
                groups: 1,
                auto_pad: NotSet,
            },
        },
    )
    "#);
}

#[test]
fn conv_transpose() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "convtranspose2d");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ConvTranspose2d(
        ConvTranspose2dNode {
            name: "convtranspose2d1",
            inputs: [
                Argument {
                    name: "convtranspose_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        5,
                                    ),
                                    Some(
                                        5,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        3,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "convtranspose2d1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        5,
                                    ),
                                    Some(
                                        5,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ConvTranspose2dConfig {
                kernel_size: [
                    3,
                    3,
                ],
                stride: [
                    1,
                    1,
                ],
                dilation: [
                    1,
                    1,
                ],
                padding: [
                    0,
                    0,
                ],
                padding_out: [
                    0,
                    0,
                ],
                groups: 1,
            },
        },
    )
    "#);
}

#[test]
fn cum_sum() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "cumsum");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    CumSum(
        CumSumNode {
            name: "cumsum1",
            inputs: [
                Argument {
                    name: "cumsum_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Scalar(
                        I32,
                    ),
                    value_source: Static(
                        4,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "cumsum1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: CumSumConfig {
                axis: Static(
                    1,
                ),
                exclusive: false,
                reverse: false,
            },
        },
    )
    "#);
}

#[test]
fn depth_to_space() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "depthtospace");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    DepthToSpace(
        DepthToSpaceNode {
            name: "depthtospace1",
            inputs: [
                Argument {
                    name: "depthtospace_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        8,
                                    ),
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "depthtospace1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        4,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: DepthToSpaceConfig {
                mode: Dcr,
                block_size: 2,
            },
        },
    )
    "#);
}

#[test]
fn equal() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "equal");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Equal(
        EqualNode {
            name: "equal1",
            inputs: [
                Argument {
                    name: "equal_a",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "equal_b",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "equal1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: Bool,
                            rank: 3,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
        },
    )
    "#);
}

#[test]
fn flatten() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "flatten");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Flatten(
        FlattenNode {
            name: "flatten1",
            inputs: [
                Argument {
                    name: "flatten_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "flatten1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        12,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: FlattenConfig {
                axis: 1,
            },
        },
    )
    "#);
}

#[test]
fn gather() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "gather");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Gather(
        GatherNode {
            name: "gather1",
            inputs: [
                Argument {
                    name: "gather_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "constant6_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
            ],
            outputs: [
                Argument {
                    name: "gather1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: GatherConfig {
                axis: 0,
            },
        },
    )
    "#);
}

#[test]
fn gather_elements() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "gatherelements");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    GatherElements(
        GatherElementsNode {
            name: "gatherelements1",
            inputs: [
                Argument {
                    name: "gatherelements_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "constant7_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
            ],
            outputs: [
                Argument {
                    name: "gatherelements1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: GatherElementsConfig {
                indices: Static(
                    [
                        0,
                        1,
                        0,
                        1,
                        0,
                        1,
                    ],
                ),
                axis: 0,
            },
        },
    )
    "#);
}

#[test]
fn gather_nd() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "gathernd");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    GatherND(
        GatherNDNode {
            name: "gathernd1",
            inputs: [
                Argument {
                    name: "gathernd_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "constant8_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
            ],
            outputs: [
                Argument {
                    name: "gathernd1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: GatherNDConfig {
                batch_dims: 0,
            },
        },
    )
    "#);
}

#[test]
fn gemm() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "gemm");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Gemm(
        GemmNode {
            name: "gemm1",
            inputs: [
                Argument {
                    name: "gemm_a",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "constant9_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
                Argument {
                    name: "constant10_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
            ],
            outputs: [
                Argument {
                    name: "gemm1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: GemmConfig {
                alpha: 1.0,
                beta: 1.0,
                trans_a: 0,
                trans_b: 0,
            },
        },
    )
    "#);
}

#[test]
fn if_op() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "if");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    If(
        IfNode {
            name: "if1",
            inputs: [
                Argument {
                    name: "if_condition",
                    ty: Scalar(
                        Bool,
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "if1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: IfConfig {
                then_branch: OnnxGraph {
                    nodes: [
                        Constant(
                            ConstantNode {
                                name: "constant31",
                                inputs: [
                                    Argument {
                                        name: "",
                                        ty: Tensor(
                                            TensorType {
                                                dtype: F32,
                                                rank: 2,
                                                static_shape: Some(
                                                    [
                                                        Some(
                                                            2,
                                                        ),
                                                        Some(
                                                            3,
                                                        ),
                                                    ],
                                                ),
                                            },
                                        ),
                                        value_source: Static(
                                            0,
                                        ),
                                    },
                                ],
                                outputs: [
                                    Argument {
                                        name: "constant31_out1",
                                        ty: Tensor(
                                            TensorType {
                                                dtype: F32,
                                                rank: 2,
                                                static_shape: Some(
                                                    [
                                                        Some(
                                                            2,
                                                        ),
                                                        Some(
                                                            3,
                                                        ),
                                                    ],
                                                ),
                                            },
                                        ),
                                        value_source: Constant,
                                    },
                                ],
                            },
                        ),
                    ],
                    inputs: [],
                    outputs: [
                        Argument {
                            name: "constant31_out1",
                            ty: Tensor(
                                TensorType {
                                    dtype: F32,
                                    rank: 2,
                                    static_shape: Some(
                                        [
                                            Some(
                                                2,
                                            ),
                                            Some(
                                                3,
                                            ),
                                        ],
                                    ),
                                },
                            ),
                            value_source: Constant,
                        },
                    ],
                    value_store: Some(
                        ValueStore {
                            tensor_store: TensorStore {
                                data: {
                                    0: TensorDataRef {
                                        shape: [
                                            2,
                                            3,
                                        ],
                                        dtype: F32,
                                        source: Embedded(
                                            b"\0\0\x80?\0\0\x80?\0\0\x80?\0\0\x80?\0\0\x80?\0\0\x80?",
                                        ),
                                    },
                                },
                                next_id: 1,
                            },
                            constant_map: {
                                "constant31_out1": 0,
                            },
                        },
                    ),
                },
                else_branch: OnnxGraph {
                    nodes: [
                        Constant(
                            ConstantNode {
                                name: "constant32",
                                inputs: [
                                    Argument {
                                        name: "",
                                        ty: Tensor(
                                            TensorType {
                                                dtype: F32,
                                                rank: 2,
                                                static_shape: Some(
                                                    [
                                                        Some(
                                                            2,
                                                        ),
                                                        Some(
                                                            3,
                                                        ),
                                                    ],
                                                ),
                                            },
                                        ),
                                        value_source: Static(
                                            0,
                                        ),
                                    },
                                ],
                                outputs: [
                                    Argument {
                                        name: "constant32_out1",
                                        ty: Tensor(
                                            TensorType {
                                                dtype: F32,
                                                rank: 2,
                                                static_shape: Some(
                                                    [
                                                        Some(
                                                            2,
                                                        ),
                                                        Some(
                                                            3,
                                                        ),
                                                    ],
                                                ),
                                            },
                                        ),
                                        value_source: Constant,
                                    },
                                ],
                            },
                        ),
                    ],
                    inputs: [],
                    outputs: [
                        Argument {
                            name: "constant32_out1",
                            ty: Tensor(
                                TensorType {
                                    dtype: F32,
                                    rank: 2,
                                    static_shape: Some(
                                        [
                                            Some(
                                                2,
                                            ),
                                            Some(
                                                3,
                                            ),
                                        ],
                                    ),
                                },
                            ),
                            value_source: Constant,
                        },
                    ],
                    value_store: Some(
                        ValueStore {
                            tensor_store: TensorStore {
                                data: {
                                    0: TensorDataRef {
                                        shape: [
                                            2,
                                            3,
                                        ],
                                        dtype: F32,
                                        source: Embedded(
                                            b"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",
                                        ),
                                    },
                                },
                                next_id: 1,
                            },
                            constant_map: {
                                "constant32_out1": 0,
                            },
                        },
                    ),
                },
                scope_ref_names: [],
            },
        },
    )
    "#);
}

#[test]
fn max_pool() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "maxpool2d");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    MaxPool2d(
        MaxPool2dNode {
            name: "maxpool2d1",
            inputs: [
                Argument {
                    name: "maxpool_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        8,
                                    ),
                                    Some(
                                        8,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "maxpool2d1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        8,
                                    ),
                                    Some(
                                        8,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: MaxPool2dConfig {
                kernel_size: [
                    2,
                    2,
                ],
                strides: [
                    2,
                    2,
                ],
                padding: Valid,
                dilation: [
                    1,
                    1,
                ],
                ceil_mode: false,
                auto_pad: NotSet,
            },
        },
    )
    "#);
}

#[test]
fn one_hot() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "onehot");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    OneHot(
        OneHotNode {
            name: "onehot1",
            inputs: [
                Argument {
                    name: "onehot_indices",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Scalar(
                        I64,
                    ),
                    value_source: Static(
                        10,
                    ),
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        11,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "onehot1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: OneHotConfig {
                depth: Static(
                    5,
                ),
                values: Static(
                    [
                        0.0,
                        1.0,
                    ],
                ),
                axis: -1,
            },
        },
    )
    "#);
}

#[test]
fn pad() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "pad");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Pad(
        PadNode {
            name: "pad1",
            inputs: [
                Argument {
                    name: "pad_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        12,
                    ),
                },
                Argument {
                    name: "",
                    ty: Scalar(
                        F32,
                    ),
                    value_source: Static(
                        13,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "pad1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: PadConfig {
                pads: Static(
                    [
                        1,
                        1,
                        0,
                        0,
                    ],
                ),
                constant_value: Static(
                    0.0,
                ),
                mode: Constant,
            },
        },
    )
    "#);
}

#[test]
fn range() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "range");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Range(
        RangeNode {
            name: "range1",
            inputs: [
                Argument {
                    name: "",
                    ty: Scalar(
                        F32,
                    ),
                    value_source: Static(
                        14,
                    ),
                },
                Argument {
                    name: "",
                    ty: Scalar(
                        F32,
                    ),
                    value_source: Static(
                        15,
                    ),
                },
                Argument {
                    name: "",
                    ty: Scalar(
                        F32,
                    ),
                    value_source: Static(
                        16,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "range1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 1,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: RangeConfig {
                start: Static(
                    0,
                ),
                limit: Static(
                    10,
                ),
                delta: Static(
                    2,
                ),
            },
        },
    )
    "#);
}

#[test]
fn reduce_l1() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reducel1");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceL1(
        ReduceL1Node {
            name: "reducel11",
            inputs: [
                Argument {
                    name: "reducel1_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducel11_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_l2() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reducel2");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceL2(
        ReduceL2Node {
            name: "reducel21",
            inputs: [
                Argument {
                    name: "reducel2_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducel21_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_log_sum() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reducelogsum");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceLogSum(
        ReduceLogSumNode {
            name: "reducelogsum1",
            inputs: [
                Argument {
                    name: "reducelogsum_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducelogsum1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_log_sum_exp() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reducelogsumexp");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceLogSumExp(
        ReduceLogSumExpNode {
            name: "reducelogsumexp1",
            inputs: [
                Argument {
                    name: "reducelogsumexp_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducelogsumexp1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_max() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reducemax");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceMax(
        ReduceMaxNode {
            name: "reducemax1",
            inputs: [
                Argument {
                    name: "reducemax_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducemax1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_mean() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reducemean");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceMean(
        ReduceMeanNode {
            name: "reducemean1",
            inputs: [
                Argument {
                    name: "reducemean_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducemean1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_min() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reducemin");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceMin(
        ReduceMinNode {
            name: "reducemin1",
            inputs: [
                Argument {
                    name: "reducemin_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducemin1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_prod() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reduceprod");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceProd(
        ReduceProdNode {
            name: "reduceprod1",
            inputs: [
                Argument {
                    name: "reduceprod_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reduceprod1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_sum() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reducesum");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceSum(
        ReduceSumNode {
            name: "reducesum1",
            inputs: [
                Argument {
                    name: "reducesum_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducesum1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn reduce_sum_square() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "reducesumsquare");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ReduceSumSquare(
        ReduceSumSquareNode {
            name: "reducesumsquare1",
            inputs: [
                Argument {
                    name: "reducesumsquare_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "reducesumsquare1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ReduceConfig {
                dims: [
                    1,
                ],
                keepdims: true,
            },
        },
    )
    "#);
}

#[test]
fn resize() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "resize");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Resize(
        ResizeNode {
            name: "resize1",
            inputs: [
                Argument {
                    name: "resize_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        0,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        17,
                    ),
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        0,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        18,
                    ),
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        19,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "resize1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 4,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ResizeConfig {
                mode: Nearest,
                scales: None,
                sizes: Some(
                    Static(
                        [
                            4,
                            4,
                        ],
                    ),
                ),
                coordinate_transformation_mode: "half_pixel",
                cubic_coeff_a: -0.75,
                nearest_mode: "round_prefer_floor",
                exclude_outside: 0,
                extrapolation_value: 0.0,
                antialias: 0,
            },
        },
    )
    "#);
}

#[test]
fn round() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "round");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Round(
        RoundNode {
            name: "round1",
            inputs: [
                Argument {
                    name: "round_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "round1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 3,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
        },
    )
    "#);
}

#[test]
fn scatter_elements() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "scatterelements");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ScatterElements(
        ScatterElementsNode {
            name: "scatterelements1",
            inputs: [
                Argument {
                    name: "scatterelements_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "constant21_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
                Argument {
                    name: "scatterelements_updates",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "scatterelements1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        3,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ScatterElementsConfig {
                axis: 0,
                reduction: None,
            },
        },
    )
    "#);
}

#[test]
fn scatter_nd() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "scatternd");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    ScatterND(
        ScatterNDNode {
            name: "scatternd1",
            inputs: [
                Argument {
                    name: "scatternd_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        4,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "constant22_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        1,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Constant,
                },
                Argument {
                    name: "scatternd_updates",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "scatternd1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        4,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: ScatterNDConfig {
                reduction: None,
            },
        },
    )
    "#);
}

#[test]
fn slice() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "slice");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Slice(
        SliceNode {
            name: "slice1",
            inputs: [
                Argument {
                    name: "slice_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        4,
                                    ),
                                    Some(
                                        6,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        22,
                    ),
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        23,
                    ),
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        24,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "slice1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        4,
                                    ),
                                    Some(
                                        6,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: SliceConfig {
                starts: Static(
                    [
                        0,
                        1,
                    ],
                ),
                ends: Static(
                    [
                        2,
                        4,
                    ],
                ),
                axes: Some(
                    Static(
                        [
                            0,
                            1,
                        ],
                    ),
                ),
                steps: Some(
                    Static(
                        [
                            1,
                            1,
                        ],
                    ),
                ),
            },
        },
    )
    "#);
}

#[test]
fn split() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "split");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    Split(
        SplitNode {
            name: "split1",
            inputs: [
                Argument {
                    name: "split_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        2,
                                    ),
                                    Some(
                                        6,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            outputs: [
                Argument {
                    name: "split1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "split1_out2",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: SplitConfig {
                axis: 1,
                split_size: Some(
                    3,
                ),
                split_sizes: None,
                num_outputs: None,
            },
        },
    )
    "#);
}

#[test]
fn top_k() {
    let graph = load_model("opset_11.onnx");
    let node = find_node(&graph, "topk");
    insta::assert_snapshot!(format!("{node:#?}"), @r#"
    TopK(
        TopKNode {
            name: "topk1",
            inputs: [
                Argument {
                    name: "topk_input",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: Some(
                                [
                                    Some(
                                        3,
                                    ),
                                    Some(
                                        4,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 1,
                            static_shape: Some(
                                [
                                    Some(
                                        1,
                                    ),
                                ],
                            ),
                        },
                    ),
                    value_source: Static(
                        25,
                    ),
                },
            ],
            outputs: [
                Argument {
                    name: "topk1_out1",
                    ty: Tensor(
                        TensorType {
                            dtype: F32,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
                Argument {
                    name: "topk1_out2",
                    ty: Tensor(
                        TensorType {
                            dtype: I64,
                            rank: 2,
                            static_shape: None,
                        },
                    ),
                    value_source: Dynamic,
                },
            ],
            config: TopKConfig {
                axis: 1,
                k: Static(
                    2,
                ),
            },
        },
    )
    "#);
}

/// Ops that require min_opset > 11: Hardmax, LogSoftmax, Softmax, Squeeze, Unsqueeze
#[test]
fn unsupported_ops_fail() {
    let result = load_model_result("opset_11_unsupported.onnx");
    assert!(
        result.is_err(),
        "expected parse failure for unsupported ops at opset 11"
    );
}
